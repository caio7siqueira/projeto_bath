openapi: 3.0.0
paths:
  /auth/register:
    post:
      operationId: AuthController_register
      summary: Register new user
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RegisterDto"
      responses:
        "201":
          description: User registered successfully
        "409":
          description: Email already exists
      tags: &a1
        - Auth
  /auth/login:
    post:
      operationId: AuthController_login
      summary: Login user
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LoginDto"
      responses:
        "200":
          description: Login successful
        "401":
          description: Invalid credentials
        "429":
          description: Limite de tentativas excedido
      tags: *a1
  /auth/refresh:
    post:
      operationId: AuthController_refresh
      summary: Refresh access token
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RefreshDto"
      responses:
        "200":
          description: Token refreshed successfully
        "401":
          description: Invalid refresh token
        "429":
          description: Limite de tentativas excedido
      tags: *a1
  /auth/logout:
    post:
      operationId: AuthController_logout
      summary: Logout user
      parameters: []
      responses:
        "200":
          description: Logout successful
      tags: *a1
      security:
        - bearer: []
  /customer-auth/request-otp:
    post:
      operationId: CustomerAuthController_requestOtp
      summary: Request OTP code via SMS
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RequestOtpDto"
      responses:
        "200":
          description: OTP sent
        "429":
          description: Limite de solicitações de OTP excedido
      tags: &a2
        - Customer Auth
  /customer-auth/verify-otp:
    post:
      operationId: CustomerAuthController_verifyOtp
      summary: Verify OTP and issue JWT
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/VerifyOtpDto"
      responses:
        "200":
          description: JWT issued
        "429":
          description: Tentativas de verificação excedidas
      tags: *a2
  /protected/ping:
    get:
      operationId: ProtectedController_ping
      summary: Ping with auth
      parameters: []
      responses:
        "200":
          description: ""
      tags: &a3
        - Protected
      security: &a4
        - bearer: []
  /protected/admin-only:
    get:
      operationId: ProtectedController_adminOnly
      summary: Admin-only endpoint
      parameters: []
      responses:
        "200":
          description: ""
      tags: *a3
      security: *a4
  /protected/tenant/{tenantId}:
    get:
      operationId: ProtectedController_tenantCheck
      summary: Enforce same tenant access
      parameters:
        - name: tenantId
          required: true
          in: path
          schema:
            type: string
      responses:
        "200":
          description: ""
      tags: *a3
      security: *a4
  /tenants:
    post:
      operationId: TenantsController_create
      summary: Criar novo tenant (ADMIN)
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateTenantDto"
      responses:
        "201":
          description: ""
      tags: &a5
        - Tenants
      security: &a6
        - bearer: []
    get:
      operationId: TenantsController_findAll
      summary: Listar todos os tenants (ADMIN)
      parameters:
        - name: page
          required: false
          in: query
          description: Page number
          schema:
            minimum: 1
            type: number
        - name: pageSize
          required: false
          in: query
          description: Items per page
          schema:
            minimum: 1
            maximum: 100
            type: number
        - name: sort
          required: false
          in: query
          description: Sort field and direction, e.g., "createdAt:desc"
          schema:
            example: createdAt:desc
            type: string
      responses:
        "200":
          description: ""
      tags: *a5
      security: *a6
  /tenants/{id}:
    get:
      operationId: TenantsController_findById
      summary: Obter tenant por ID (ADMIN)
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        "200":
          description: ""
      tags: *a5
      security: *a6
    patch:
      operationId: TenantsController_update
      summary: Atualizar tenant (ADMIN)
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateTenantDto"
      responses:
        "200":
          description: ""
      tags: *a5
      security: *a6
  /locations:
    post:
      operationId: LocationsController_create
      summary: Criar nova localização (ADMIN/STAFF)
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateLocationDto"
      responses:
        "201":
          description: ""
      tags: &a7
        - Locations
      security: &a8
        - bearer: []
    get:
      operationId: LocationsController_findByTenant
      summary: Listar localizações do tenant
      parameters:
        - name: page
          required: false
          in: query
          description: Page number
          schema:
            minimum: 1
            type: number
        - name: pageSize
          required: false
          in: query
          description: Items per page
          schema:
            minimum: 1
            maximum: 100
            type: number
        - name: sort
          required: false
          in: query
          description: Sort field and direction, e.g., "createdAt:desc"
          schema:
            example: createdAt:desc
            type: string
      responses:
        "200":
          description: ""
      tags: *a7
      security: *a8
  /locations/{id}:
    get:
      operationId: LocationsController_findById
      summary: Obter localização por ID
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        "200":
          description: ""
      tags: *a7
      security: *a8
    patch:
      operationId: LocationsController_update
      summary: Atualizar localização (ADMIN/STAFF)
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateLocationDto"
      responses:
        "200":
          description: ""
      tags: *a7
      security: *a8
  /customers:
    post:
      operationId: CustomersController_create
      summary: Create a new customer
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateCustomerDto"
      responses:
        "201":
          description: Customer created successfully
        "409":
          description: Customer with this phone already exists
      tags: &a9
        - customers
      security: &a10
        - bearer: []
    get:
      operationId: CustomersController_findAll
      summary: List all customers
      parameters:
        - name: page
          required: false
          in: query
          description: Page number
          schema:
            minimum: 1
            type: number
        - name: pageSize
          required: false
          in: query
          description: Items per page
          schema:
            minimum: 1
            maximum: 100
            type: number
        - name: sort
          required: false
          in: query
          description: Sort field and direction, e.g., "createdAt:desc"
          schema:
            example: createdAt:desc
            type: string
        - name: q
          required: false
          in: query
          description: Search in name, email or phone
          schema:
            type: string
        - name: email
          required: false
          in: query
          description: Filter by exact email
          schema:
            type: string
        - name: phone
          required: false
          in: query
          description: Filter by exact phone
          schema:
            type: string
      responses:
        "200":
          description: Customers list retrieved successfully
      tags: *a9
      security: *a10
  /customers/{id}:
    get:
      operationId: CustomersController_findOne
      summary: Get a customer by ID
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        "200":
          description: Customer retrieved successfully
        "404":
          description: Customer not found
      tags: *a9
      security: *a10
    delete:
      operationId: CustomersController_softDelete
      summary: Soft delete customer (ADMIN/SUPERADMIN)
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        "200":
          description: Customer deleted (soft)
        "404":
          description: Customer not found
        "409":
          description: Customer already deleted
      tags: *a9
      security: *a10
    patch:
      operationId: CustomersController_update
      summary: Update a customer
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateCustomerDto"
      responses:
        "200":
          description: Customer updated successfully
        "404":
          description: Customer not found
        "409":
          description: Customer with this phone already exists
      tags: *a9
      security: *a10
  /customers/{customerId}/contacts:
    get:
      operationId: CustomersController_findContacts
      summary: Listar contatos relacionados ao customer
      parameters:
        - name: customerId
          required: true
          in: path
          schema:
            type: string
      responses:
        "200":
          description: ""
      tags: *a9
      security: *a10
    post:
      operationId: CustomersController_createContact
      summary: Criar contato relacionado ao customer
      parameters:
        - name: customerId
          required: true
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateContactDto"
      responses:
        "201":
          description: ""
      tags: *a9
      security: *a10
  /customers/{customerId}/contacts/{contactId}:
    patch:
      operationId: CustomersController_updateContact
      summary: Atualizar contato de customer
      parameters:
        - name: customerId
          required: true
          in: path
          schema:
            type: string
        - name: contactId
          required: true
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateContactDto"
      responses:
        "200":
          description: ""
      tags: *a9
      security: *a10
    delete:
      operationId: CustomersController_deleteContact
      summary: Remover contato de customer
      parameters:
        - name: customerId
          required: true
          in: path
          schema:
            type: string
        - name: contactId
          required: true
          in: path
          schema:
            type: string
      responses:
        "200":
          description: ""
      tags: *a9
      security: *a10
  /appointments:
    post:
      operationId: AppointmentsController_create
      summary: Criar novo agendamento
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateAppointmentDto"
      responses:
        "201":
          description: Agendamento criado com sucesso
        "400":
          description: Dados inválidos (startsAt >= endsAt ou duração < 5min)
        "404":
          description: Cliente ou localização não encontrados
        "409":
          description: "Conflito: overlap com outro agendamento"
      tags: &a11
        - appointments
      security: &a12
        - bearer: []
    get:
      operationId: AppointmentsController_findAll
      summary: Listar agendamentos com filtros opcionais
      parameters:
        - name: page
          required: false
          in: query
          description: Page number
          schema:
            minimum: 1
            type: number
        - name: pageSize
          required: false
          in: query
          description: Items per page
          schema:
            minimum: 1
            maximum: 100
            type: number
        - name: sort
          required: false
          in: query
          description: Sort field and direction, e.g., "createdAt:desc"
          schema:
            example: createdAt:desc
            type: string
        - name: locationId
          required: false
          in: query
          schema:
            type: string
        - name: customerId
          required: false
          in: query
          schema:
            type: string
        - name: from
          required: false
          in: query
          description: Filter from date (ISO 8601)
          schema:
            type: string
        - name: to
          required: false
          in: query
          description: Filter to date (ISO 8601)
          schema:
            type: string
        - name: status
          required: false
          in: query
          schema:
            enum:
              - SCHEDULED
              - CANCELLED
              - DONE
            type: string
      responses:
        "200":
          description: Lista de agendamentos (array ou paginated response)
      tags: *a11
      security: *a12
  /appointments/{id}:
    get:
      operationId: AppointmentsController_findOne
      summary: Buscar agendamento por ID
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        "200":
          description: Agendamento encontrado
        "404":
          description: Agendamento não encontrado
      tags: *a11
      security: *a12
    patch:
      operationId: AppointmentsController_update
      summary: Atualizar agendamento
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateAppointmentDto"
      responses:
        "200":
          description: Agendamento atualizado com sucesso
        "400":
          description: Dados inválidos
        "404":
          description: Agendamento não encontrado
        "409":
          description: "Conflito: overlap com outro agendamento"
      tags: *a11
      security: *a12
  /appointments/{id}/cancel:
    post:
      operationId: AppointmentsController_cancel
      summary: Cancelar agendamento (idempotente)
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        "200":
          description: Agendamento cancelado com sucesso
        "404":
          description: Agendamento não encontrado
      tags: *a11
      security: *a12
  /appointments/{id}/mark-done:
    post:
      operationId: AppointmentsController_markDone
      summary: Marcar agendamento como DONE (idempotente)
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        "200":
          description: Agendamento marcado como DONE
        "400":
          description: Não é possível marcar cancelado como DONE
        "404":
          description: Agendamento não encontrado
      tags: *a11
      security: *a12
  /reports/appointments/summary:
    get:
      operationId: ReportsController_getAppointmentsSummary
      summary: Resumo de agendamentos por status no período
      parameters:
        - name: from
          required: false
          in: query
          description: Data inicial ISO 8601 (inclusive)
          schema:
            type: string
        - name: to
          required: false
          in: query
          description: Data final ISO 8601 (inclusive)
          schema:
            type: string
      responses:
        "200":
          description: Contagens agregadas
      tags: &a13
        - reports
      security: &a14
        - bearer: []
  /reports/appointments/timeseries:
    get:
      operationId: ReportsController_getAppointmentsTimeseries
      summary: Série temporal de agendamentos (day|month)
      parameters:
        - name: from
          required: false
          in: query
          description: Data inicial ISO 8601 (inclusive)
          schema:
            type: string
        - name: to
          required: false
          in: query
          description: Data final ISO 8601 (inclusive)
          schema:
            type: string
        - name: granularity
          required: false
          in: query
          schema:
            default: day
            enum:
              - day
              - month
            type: string
      responses:
        "200":
          description: Lista de buckets por período
      tags: *a13
      security: *a14
  /pets:
    get:
      operationId: PetsController_listAll
      summary: Listar todos os pets do tenant (paginado)
      parameters:
        - name: page
          required: false
          in: query
          description: Page number
          schema:
            minimum: 1
            type: number
        - name: pageSize
          required: false
          in: query
          description: Items per page
          schema:
            minimum: 1
            maximum: 100
            type: number
        - name: sort
          required: false
          in: query
          description: Sort field and direction, e.g., "createdAt:desc"
          schema:
            example: createdAt:desc
            type: string
        - name: q
          required: false
          in: query
          description: Filtro por nome do pet
          schema:
            type: string
      responses:
        "200":
          description: Lista paginada de pets
      tags: &a15
        - pets
      security: &a16
        - bearer: []
  /customers/{customerId}/pets:
    get:
      operationId: PetsController_list
      summary: Listar pets de um customer
      parameters:
        - name: customerId
          required: true
          in: path
          schema:
            type: string
        - name: page
          required: false
          in: query
          description: Page number
          schema:
            minimum: 1
            type: number
        - name: pageSize
          required: false
          in: query
          description: Items per page
          schema:
            minimum: 1
            maximum: 100
            type: number
        - name: sort
          required: false
          in: query
          description: Sort field and direction, e.g., "createdAt:desc"
          schema:
            example: createdAt:desc
            type: string
      responses:
        "200":
          description: Lista de pets
      tags: *a15
      security: *a16
    post:
      operationId: PetsController_create
      summary: Criar pet para um customer
      parameters:
        - name: customerId
          required: true
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreatePetDto"
      responses:
        "201":
          description: Pet criado
      tags: *a15
      security: *a16
  /pets/{petId}:
    patch:
      operationId: PetsController_update
      summary: Atualizar pet (nome, lifeStatus, allowNotifications)
      parameters:
        - name: petId
          required: true
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdatePetDto"
      responses:
        "200":
          description: Pet atualizado
      tags: *a15
      security: *a16
  /pets/{petId}/mark-deceased:
    post:
      operationId: PetsController_markDeceased
      summary: Marcar pet como falecido
      parameters:
        - name: petId
          required: true
          in: path
          schema:
            type: string
      responses:
        "200":
          description: Pet marcado como falecido
        "404":
          description: Pet não encontrado
        "422":
          description: Pet já está falecido
      tags: *a15
      security: *a16
  /dashboard/reports:
    get:
      operationId: DashboardController_getReports
      summary: Get dashboard summary with totals
      parameters: []
      responses:
        "200":
          description: Dashboard stats
      tags:
        - dashboard
      security:
        - bearer: []
  /integrations/omie/connection:
    get:
      operationId: OmieController_getConnection
      summary: Exibir status da conexão Omie (ADMIN)
      parameters: []
      responses:
        "200":
          description: ""
      tags: &a17
        - integrations
      security: &a18
        - bearer: []
    put:
      operationId: OmieController_upsertConnection
      summary: Atualizar credenciais Omie (ADMIN)
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpsertOmieConnectionDto"
      responses:
        "200":
          description: ""
      tags: *a17
      security: *a18
  /integrations/omie/connection/test:
    post:
      operationId: OmieController_testConnection
      summary: Testar credenciais Omie (ADMIN)
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/TestOmieConnectionDto"
      responses:
        "201":
          description: ""
      tags: *a17
      security: *a18
  /integrations/omie/events:
    get:
      operationId: OmieController_listEvents
      summary: Listar eventos Omie por tenant (ADMIN)
      parameters: []
      responses:
        "200":
          description: ""
      tags: *a17
      security: *a18
  /integrations/omie/reprocess/{eventId}:
    post:
      operationId: OmieController_reprocessEvent
      summary: Reprocessar evento Omie com erro (ADMIN)
      parameters:
        - name: eventId
          required: true
          in: path
          schema:
            type: string
      responses:
        "201":
          description: ""
      tags: *a17
      security: *a18
  /integrations/omie/internal/process/{eventId}:
    post:
      operationId: OmieController_processEvent
      summary: Processar evento Omie (chamado pelo worker)
      parameters:
        - name: eventId
          required: true
          in: path
          schema:
            type: string
      responses:
        "201":
          description: ""
      tags: *a17
      security: *a18
  /integrations/notifications/internal/mark/{id}:
    post:
      operationId: NotificationsController_mark
      summary: Atualiza status de NotificationJob (chamado pelo worker)
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        "201":
          description: ""
      tags: &a19
        - notifications
  /integrations/notifications/admin/jobs:
    get:
      operationId: NotificationsController_listJobs
      summary: Listar NotificationJobs do tenant (ADMIN)
      parameters:
        - name: page
          required: false
          in: query
          description: Page number
          schema:
            minimum: 1
            type: number
        - name: pageSize
          required: false
          in: query
          description: Items per page
          schema:
            minimum: 1
            maximum: 100
            type: number
        - name: sort
          required: false
          in: query
          description: Sort field and direction, e.g., "createdAt:desc"
          schema:
            example: createdAt:desc
            type: string
        - name: status
          required: false
          in: query
          description: Filtra jobs por status
          schema:
            enum:
              - SCHEDULED
              - SENT
              - ERROR
              - CANCELLED
            type: string
      responses:
        "200":
          description: ""
      tags: *a19
      security:
        - bearer: []
  /v1/notification-job:
    post:
      operationId: NotificationJobController_create
      parameters: []
      responses:
        "201":
          description: ""
  /admin/tenant-config:
    get:
      operationId: TenantConfigController_get
      summary: Obter configurações do tenant
      parameters: []
      responses:
        "200":
          description: ""
      tags: &a20
        - admin
      security: &a21
        - bearer: []
    put:
      operationId: TenantConfigController_update
      summary: Atualizar configurações do tenant
      parameters: []
      responses:
        "200":
          description: ""
      tags: *a20
      security: *a21
  /admin/billing/subscription:
    get:
      operationId: BillingController_getCurrent
      summary: Obter assinatura atual do tenant
      parameters: []
      responses:
        "200":
          description: ""
      tags: &a22
        - billing
      security: &a23
        - bearer: []
    put:
      operationId: BillingController_upsert
      summary: Criar nova versão da assinatura do tenant
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpsertBillingSubscriptionDto"
      responses:
        "200":
          description: ""
      tags: *a22
      security: *a23
  /services:
    post:
      operationId: ServicesController_create
      summary: Criar um serviço
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateServiceDto"
      responses:
        "201":
          description: Serviço criado com sucesso
        "409":
          description: Nome já existe para este tenant
      tags: &a24
        - services
      security: &a25
        - bearer: []
    get:
      operationId: ServicesController_findAll
      summary: Listar serviços do tenant
      parameters:
        - name: page
          required: false
          in: query
          description: Page number
          schema:
            minimum: 1
            type: number
        - name: pageSize
          required: false
          in: query
          description: Items per page
          schema:
            minimum: 1
            maximum: 100
            type: number
        - name: sort
          required: false
          in: query
          description: Sort field and direction, e.g., "createdAt:desc"
          schema:
            example: createdAt:desc
            type: string
        - name: includeInactive
          required: false
          in: query
          description: Define se serviços inativos devem ser incluídos
          schema:
            type: boolean
      responses:
        "200":
          description: Lista de serviços
      tags: *a24
      security: *a25
  /recurrence-series:
    post:
      operationId: RecurrenceSeriesController_create
      summary: Criar série de recorrência
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateRecurrenceSeriesDto"
      responses:
        "201":
          description: Recorrência criada e instâncias geradas
      tags: &a26
        - recurrence-series
      security: &a27
        - bearer: []
  /recurrence-series/{id}:
    patch:
      operationId: RecurrenceSeriesController_update
      summary: Editar série de recorrência
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateRecurrenceSeriesDto"
      responses:
        "200":
          description: Recorrência atualizada
      tags: *a26
      security: *a27
  /superadmin/tenants:
    get:
      operationId: SuperadminController_listTenants
      parameters:
        - name: page
          required: false
          in: query
          description: Page number
          schema:
            minimum: 1
            type: number
        - name: pageSize
          required: false
          in: query
          description: Items per page
          schema:
            minimum: 1
            maximum: 100
            type: number
        - name: sort
          required: false
          in: query
          description: Sort field and direction, e.g., "createdAt:desc"
          schema:
            example: createdAt:desc
            type: string
      responses:
        "200":
          description: ""
      tags: &a28
        - superadmin
      security: &a29
        - bearer: []
  /superadmin/tenants/{id}:
    get:
      operationId: SuperadminController_getTenant
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        "200":
          description: ""
      tags: *a28
      security: *a29
  /superadmin/tenants/{id}/suspend:
    post:
      operationId: SuperadminController_suspendTenant
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        "201":
          description: ""
      tags: *a28
      security: *a29
  /superadmin/tenants/{id}/activate:
    post:
      operationId: SuperadminController_activateTenant
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        "201":
          description: ""
      tags: *a28
      security: *a29
  /superadmin/audit-logs:
    get:
      operationId: SuperadminController_getAuditLogs
      parameters:
        - name: page
          required: false
          in: query
          description: Page number
          schema:
            minimum: 1
            type: number
        - name: pageSize
          required: false
          in: query
          description: Items per page
          schema:
            minimum: 1
            maximum: 100
            type: number
        - name: sort
          required: false
          in: query
          description: Sort field and direction, e.g., "createdAt:desc"
          schema:
            example: createdAt:desc
            type: string
      responses:
        "200":
          description: ""
      tags: *a28
      security: *a29
  /:
    get:
      operationId: HealthController_root
      parameters: []
      responses:
        "200":
          description: ""
  /health:
    get:
      operationId: HealthController_health
      parameters: []
      responses:
        "200":
          description: ""
info:
  title: Efizion Bath API
  description: Contratos REST padronizados com envelope `{ data, meta }` para
    todas as respostas. Use os exemplos fornecidos para alinhar payloads entre
    frontend e backend.
  version: 0.1.0
  contact: {}
tags: []
servers:
  - url: https://api.efizion.com.br
    description: Produção
  - url: http://localhost:3000
    description: Local
components:
  securitySchemes:
    bearer:
      scheme: bearer
      bearerFormat: JWT
      type: http
      description: Tokens emitidos pelos fluxos /v1/auth ou /v1/customer-auth
    x-request-id:
      type: apiKey
      in: header
      name: x-request-id
      description: Opcional. Permite correlação distribuída por request.
  schemas:
    RegisterDto:
      type: object
      properties:
        email:
          type: string
          example: admin@example.com
        password:
          type: string
          example: StrongPass123!
        name:
          type: string
          example: John Doe
        role:
          type: string
          enum:
            - ADMIN
            - STAFF
            - GROOMER
            - SUPER_ADMIN
          example: ADMIN
        tenantSlug:
          type: string
          example: efizion-bath-demo
      required:
        - email
        - password
        - name
        - role
    LoginDto:
      type: object
      properties:
        email:
          type: string
          example: admin@example.com
        password:
          type: string
          example: StrongPass123!
        tenantSlug:
          type: string
          example: efizion-bath-demo
      required:
        - email
        - password
    RefreshDto:
      type: object
      properties:
        refreshToken:
          type: string
      required:
        - refreshToken
    RequestOtpDto:
      type: object
      properties:
        tenantSlug:
          type: string
          example: efizion-bath-demo
        phone:
          type: string
          example: "+5511999999999"
      required:
        - tenantSlug
        - phone
    VerifyOtpDto:
      type: object
      properties:
        tenantSlug:
          type: string
          example: efizion-bath-demo
        phone:
          type: string
          example: "+5511999999999"
        code:
          type: string
          example: "123456"
      required:
        - tenantSlug
        - phone
        - code
    CreateTenantDto:
      type: object
      properties:
        name:
          type: string
          example: Petshop Central
          description: Nome do tenant
        slug:
          type: string
          example: petshop-central
          description: Slug único (lowercase, sem espaços)
      required:
        - name
        - slug
    UpdateTenantDto:
      type: object
      properties:
        name:
          type: string
          example: Petshop Central
          description: Nome do tenant
        slug:
          type: string
          example: petshop-central
          description: Slug único (lowercase, sem espaços)
        isActive:
          type: boolean
          example: true
          description: Ativar/desativar tenant
      required:
        - isActive
    CreateLocationDto:
      type: object
      properties:
        name:
          type: string
          example: Sala de Banho A
          description: Nome da localização
      required:
        - name
    UpdateLocationDto:
      type: object
      properties:
        name:
          type: string
          example: Sala de Banho A
          description: Nome da localização
    CreateCustomerDto:
      type: object
      properties:
        name:
          type: string
          example: John Doe
        phone:
          type: string
          example: "+5511999999999"
        email:
          type: string
          example: john@example.com
        cpf:
          type: string
          example: "12345678900"
        optInGlobal:
          type: boolean
          example: true
          default: true
      required:
        - name
        - phone
    UpdateCustomerDto:
      type: object
      properties:
        name:
          type: string
          example: John Doe
        phone:
          type: string
          example: "+5511999999999"
        email:
          type: string
          example: john@example.com
        cpf:
          type: string
          example: "12345678900"
        optInGlobal:
          type: boolean
          example: true
          default: true
    CreateContactDto:
      type: object
      properties:
        name:
          type: string
          example: Maria Silva
        email:
          type: string
          example: maria@example.com
        phone:
          type: string
          example: "+5511999999999"
        birthDate:
          type: string
          example: 1990-05-10
      required:
        - name
    UpdateContactDto:
      type: object
      properties:
        name:
          type: string
          example: Maria Souza
        email:
          type: string
          example: maria@example.com
        phone:
          type: string
          example: "+5511988888888"
        birthDate:
          type: string
          example: 1990-05-10
    CreateAppointmentDto:
      type: object
      properties:
        customerId:
          type: string
        locationId:
          type: string
        petId:
          type: string
        serviceId:
          type: string
        startsAt:
          type: string
          description: ISO 8601 timestamp
          example: 2025-12-20T10:00:00Z
        endsAt:
          type: string
          description: ISO 8601 timestamp
          example: 2025-12-20T11:00:00Z
        notes:
          type: string
      required:
        - customerId
        - locationId
        - startsAt
        - endsAt
    UpdateAppointmentDto:
      type: object
      properties:
        startsAt:
          type: string
          description: ISO 8601 timestamp
        endsAt:
          type: string
          description: ISO 8601 timestamp
        notes:
          type: string
        status:
          type: string
          enum:
            - SCHEDULED
            - CANCELLED
            - DONE
    CreatePetDto:
      type: object
      properties:
        name:
          type: string
          example: Rex
        species:
          type: string
          enum:
            - DOG
            - CAT
          example: DOG
        lifeStatus:
          type: string
          enum:
            - ALIVE
            - DECEASED
          example: ALIVE
        allowNotifications:
          type: boolean
          example: true
      required:
        - name
        - species
    UpdatePetDto:
      type: object
      properties:
        name:
          type: string
          example: Rex
        lifeStatus:
          type: string
          enum:
            - ALIVE
            - DECEASED
          example: DECEASED
        allowNotifications:
          type: boolean
          example: false
    UpsertOmieConnectionDto:
      type: object
      properties: {}
    TestOmieConnectionDto:
      type: object
      properties: {}
    UpsertBillingSubscriptionDto:
      type: object
      properties: {}
    CreateServiceDto:
      type: object
      properties:
        name:
          type: string
          example: Banho completo
        description:
          type: string
          example: Banho com shampoo neutro e secagem.
        baseDurationMinutes:
          type: number
          example: 30
          description: Duração base em minutos
        active:
          type: boolean
          example: true
      required:
        - name
        - baseDurationMinutes
    CreateRecurrenceSeriesDto:
      type: object
      properties:
        rule:
          type: string
          enum:
            - WEEKLY
            - BIWEEKLY
            - MONTHLY
            - CUSTOM_INTERVAL
        interval:
          type: number
          description: Intervalo em dias para CUSTOM_INTERVAL
        startDate:
          type: string
        endDate:
          type: string
        locationId:
          type: string
        customerId:
          type: string
        petId:
          type: string
        serviceId:
          type: string
      required:
        - rule
        - startDate
        - endDate
        - locationId
        - customerId
        - petId
        - serviceId
    UpdateRecurrenceSeriesDto:
      type: object
      properties:
        rule:
          type: string
          enum:
            - WEEKLY
            - BIWEEKLY
            - MONTHLY
            - CUSTOM_INTERVAL
        interval:
          type: number
          description: Intervalo em dias para CUSTOM_INTERVAL
        startDate:
          type: string
        endDate:
          type: string
    PaginationMeta:
      type: object
      additionalProperties: false
      properties:
        page:
          type: integer
          minimum: 1
          example: 1
          description: Página atual (1-based)
        pageSize:
          type: integer
          minimum: 0
          example: 20
          description: Itens retornados por página
        total:
          type: integer
          minimum: 0
          example: 42
          description: Total de registros encontrados
        totalPages:
          type: integer
          minimum: 1
          example: 3
          description: Quantidade total de páginas
      required:
        - page
        - pageSize
        - total
        - totalPages
